version: v1.0
name: BackendWCC
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Docker
    task:
      jobs:
        - name: Deploy Docker Image
          commands:
            - checkout
            - sem-version node 12
            - docker login -u matraz -p oliveira1996
            - 'docker build -t matraz/wcc-back:$SEMAPHORE_GIT_TAG_NAME .'
            - 'docker push matraz/wcc-back:$SEMAPHORE_GIT_TAG_NAME'
  - name: Set up k8s-cli
    task:
      jobs:
        - name: Installing Kubectl
          commands:
            - 'curl -LO "https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl"'
            - chmod +x ./kubectl
            - sudo mv ./kubectl /usr/local/bin/kubectl
            - kubectl version --client
            - 'wget https://raw.githubusercontent.com/matheusraz/infos/master/config'
            - mkdir ~/.kube
            - cp config ~/.kube/config
            - kubectl get pods
